FROM node:22
WORKDIR /opt/build

# –°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY package*.json ./
RUN npm install

# –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥
COPY . .

# üëá –ö–æ–ø–∏—Ä—É–µ–º .env.production –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–∞–∫ .env
COPY .env.production .env

# –°–æ–±–∏—Ä–∞–µ–º backend
RUN npm run build -w backend

EXPOSE 8080

ENV PORT=8080
ENV NODE_ENV=production
ENV CACHE_PROVIDER=memory
ENV CORS_ORIGIN=https://newsandnews.ru,https://maxivip-news-9235.twc1.net

CMD ["npm", "start", "-w", "backend"]
